# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Категория товара

```
export type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Тип оплаты

```
export type PaymentMethod = 'online' | 'cash';
```

Массив, состоящий из id товаров

```
export type ProductId = IProduct['id'];
```

Товар в корзине

```
export type CartItem = Pick<IProduct, 'title' | 'price'>;
```

Главная страница

```
export type IMainPage = ICartIcon & IProductData;
```

Модальное окно формы оплаты

```
export type IOrder = Pick<IUser, 'payment' | 'address'>;
```

Модальное окно почты и телефона

```
export type IContacts = Pick<IUser, 'email' | 'phone'>;
```

Модальное окно успешного оформления

```
export type ISuccess = Pick<IUser, 'total'>;
```

Модель товара

```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: ProductCategory;
    price: number | null;
}
```

Ответ от сервера на получение карточек

```
export interface IProductApi {
    total: number;
    items: IProduct[];
}
```

Данные покупателя

```
export interface IUser {
    payment: PaymentMethod;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: ProductId[];
}
```

Список товаров

```
export interface IProductData {
    products: IProduct[];
    getProduct(productId: string): IProduct;
}
```

Хранение данных пользователя

```
export interface IUserData extends IUser{
    set setPaymentMethod(value: PaymentMethod);
    set setAddress(value: string);
    set setEmail(value: string);
    set setPhone(value: string);
    removeData(): void;
    checkValidation(data: Record<keyof IUser, string | number>): boolean;
}
```

Корзина

```
export interface ICart {
    items: NodeListOf<HTMLTemplateElement>;
    total: number;
    addCartItem(productElement: HTMLElement): void;
    removeCartItem(productId: string, payload: Function | null): void;
}
```

Иконка корзины на главном экране

```
export interface ICartIcon {
    counterElement: HTMLElement;
    quantity: number;
}
```

## Архитектура приложения

Код приложения написан по принципу MVP (Model-View-Presenter):
- Model- слой данных, отвечает за хранение и изменение данных
- View- слой представления, отвечает за отображение данных на странице
- Presenter- отвечает за связь данных и представления

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов.\

Конструктор класса:
`constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый адрес сервера и объект с заголовками запросов

Методы:
- `handleResponse` - обрабатывает переданный в параметрах ответ от сервера и возвращает его в формате JSON.
- `get` - отправляет `GET` запрос на переданный в параметрах эндпоинт и возвращает промис, который сразу обрабатывается методом `handleResponse`.
- `post` - принимает объект с данными, которые будут переданы в JSON  в теле запроса, и отправляет эти данные на переданный эндпоинт. По умолчанию выполняется `POST` запрос, но метод запроса можно изменить заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий, позволяет отправлять события, а также подписываться и отписываться от событий, происходящих в системе. Используется в презентере для обработки событий и в слоях приложения для генерации событий.\

Основные методы описаны интерфейсом `IEvents`:
- `on` - установить обработчик на событие
- `off` - снять обработчик с события
- `emit` - инициировать событие с данными
- `onAll` - слушать все события
- `offAll` - снять все обработчики
- `trigger` - возвращает функцию, при вызове которой инициализируется переданное в параметрах событие

#### Класс Component

Содержит в себе базовую логику управления `DOM`- элементами

Поля класса:
- `element: HTMLElement` - элемент темплейта
- `submitButton: HTMLButtonElement` - кнопка подтверждения
- `events: IEvents` - брокер событий

Конструктор класса:
`constructor(template: HTMLTemplateElement, events: IEvents)` - принимает `DOM`- элемент темплейта и экземпляр класса `EventEmitter` для возможности инициализации событий

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- геттеры и сеттеры для работы с данными

### Слой данных

#### Класс ProductData

Отвечает за хранение и логику работы с данными товаров.\
Поля класса:
- `_products: IProduct[]` - массив объектов товаров
- `_preview: string | null` - id карточки, выбранной для просмотра в модальном окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Конструктор класса:
`constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициализации событий

Методы:
- `getProduct(productId: string): IProduct` - возвращает товар по его `id`
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData

Отвечает за хранение и логику работы с данными пользователя.\

Поля класса:
- `payment: PaymentMethod` - выбранный тип оплаты
- `email: string` - почта пользователя
- `phone: string` - телефон пользователя
- `address: string` - адрес пользователя
- `total: number` - общая стоимость выбранных товаров
- `items: ProductId[]` - массив с id выбранных товаров
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Конструктор класса:
`constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициализации событий

Методы:
- `removeData(): void` - удаляет данные пользователя
- `checkValidation(data: Record<keyof IUser, string | number>): boolean` - проверяет объект с данными на валидность
- `checkField(data: {field: keyof IUser; value: string}):  boolean` - определяет валидность одного из свойств данных пользователя
- `checkAddress(value: string): boolean` - определяет валидность адреса
- `checkEmail(value: string): boolean` - определяет валидность почты
- `checkPhone(value: string): boolean` - определяет валидность телефона
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс CartData

Отвечает за хранение и логику работы с данными, добавленными в корзину.\

Поля класса:
- `total: number` - общая стоимость товаров
- `items: CartItem[]` - массив объектов товаров, добавленных в корзину
- `events: IEvents` - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Конструктор класса:
`constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициализации событий

Методы:
- `countTotalPrice(): number` - счетчик общей стоимости
- `addCartItem(productElement: HTMLElement): void` - добавляет товар в конец массива
- `removeCartItem(productId: string, payload: Function | null = null): void` - удаляет товар из корзины. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива
- сеттеры и геттеры для сохранения и получения данных из полей класса

### Слой представления

#### Класс Modal

Расширяет класс `Component`. Реализует модальное окно.\

Поля класса:
- `modal: HTMLElement` - элемент модального окна

Конструктор класса:
`constructor(template: HTMLTemplateElement, events: IEvents, selector: HTMLElement)` - расширяет родительский конструктор, принимает `DOM`- элемент темплейта, экземпляр класса `EventEmitter` для возможности инициализации событий и селектор, по которому в разметке страницы будет индетифицировано модальное окно

Методы:
- `open(): void` - открывает модальное окно
- `close(): void` - закрывает модальное окно, устанавливая слушатели на клавиатуру для закрытия по Esc, на клик по оверлею и кнопку- крестик

#### Класс ModalForm

Расширяет класс `Modal`. Реализует модальное окно с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\

Поля класса:
- `form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута `name` формы
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement>` - объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту `name` полей ввода

Методы:

- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ- `name` поля ввода, а значение- данные, введенные пользователем
- `setError(data: { field: string, value: string, validInfo: string }): void` - принимает объект с данными для отображения или скрытия текстов ошибок под полями ввода
- `showInputError(field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError(field: string): void` - очищает текст ошибки под указанным полем ввода
- `close(): void` - расширяет родительский метод, при закрытии дополнительно очищает поля формы и деактивирует кнопку сохранения
- `get form: HTMLElement` - геттер для получения элемента формы

#### Класс ModalCart

Расширяет класс `Modal`. Реализует модальное окно с корзиной. При сабмите инициирует событие, передавая в него объект с массивом `id` товаров и общей стоимостью. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\

Поля класса:
- `container: HTMLElement` - контейнер для отображения товаров, добавленных в корзину
- `totalPrice: HTMLElement` - элемент для отображения общей стоимости
- `_items: NodeListOf<HTMLTemplateElement>` - массив объектов товаров, добавленных в корзину

Методы:
- `updateTotalPrice(price: number): void` - обновляет общую стоимость
- `addCartItem(productElement: HTMLElement): void` - добавляет товар в конец массива
- `removeCartItem(productId: string, payload: Function | null = null): void` - удаляет товар из корзины. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива

#### Класс ModalProduct

Расширяет класс `Modal`. Реализует модальное окно с товаром. При сабмите инициирует событие, передавая в него объект с данными товара. Предоставляет метод для управления активностью кнопки сохранения. При открытии модального окна получает данные товара, которые нужно показать.\

Поля класса:
- `productDescription: HTMLElement` - элемент разметки с описанием
- `productImage: HTMLImageElement` - элемент разметки с изображением
- `productTitle: HTMLElement` - элемент разметки с названием
- `productCategory: HTMLElement` - элемент разметки с категорией
- `productPrice: HTMLElement` - элемент разметки с ценой

Методы:
- `open(data: IProduct): void` - расширяет родительский метод, принимая объект данных товара, которые используются для заполнения атрибутов элементов модального окна
- `close(): void` - расширяет родительский метод, выполняя очистку атрибутов модального окна

#### Класс Success

Расширяет класс `Modal`. Реализует модальное окно успешной покупки.\

Поля класса:
- `totalPrice: HTMLElement` - `DOM`- элемент общей стоимости купленных товаров
- `total: number` - общая стоимость товаров

Методы:
- геттер и сеттер для сохранения и получения общей стоимости товаров

#### Класс Product

Расширяет класс `Component`. Отвечает за отображение карточки товара.\

Поля класса:
- `productButton: HTMLButtonElement` - карточка товара
- `productImage: HTMLImageElement` - элемент разметки с изображением
- `productTitle: HTMLElement` - элемент разметки с названием
- `productCategory: HTMLElement` - элемент разметки с категорией
- `productPrice: HTMLElement` - элемент разметки с ценой
- `productId: string` - `id` элемента

Методы:
- `setData(productData: IProduct): void` - заполняет атрибуты элементов карточки данными
- `render(): HTMLElement` - возвращает заполненную карточку с установленными слушателями

#### Класс ProductsContainer

Отвечает за отображение блока с товарами на главной странице.\

Поля класса:
- `container: HTMLElement` - контейнер

Конструктор класса:
`constructor(containerElement: HTMLElement)` - принимает `DOM`- элемент контейнера, в котором размещаются карточки

Методы:
- `addProduct(productElement: HTMLElement): void` - добавляет карточки на страницу
- сеттер для обновления содержимого

#### Класс CartIcon

Отвечает за отображение количества добавленных товаров и открытия корзины. В конструктор класса передается DOM- элемент, в котором отображается количество товаров.\

Поля класса:
- `counterElement: HTMLElement` - элемент, содержащий общее количество товаров в корзине
- `quantity: number` - количество товаров в корзине

Конструктор класса:
`constructor(cartIconElement: HTMLElement)` - принимает `DOM`- элемент иконки корзины

Методы:
- геттер и сеттер для хранения и получения количества товаров в корзине

### Слой коммуникации

#### Класс AppApi

Реализует взаимодействие с сервером

Конструктор класса:
`constructor(api: Api)` - принимает экземпляр класса `Api`

## Взаимодействие компонентов

Код, описывающий взаимодействие данных и представления, находится в файле `index.ts`. Взаимодействие осуществляется при помощи событий, генерируемых брокером событий, и обработчиков этих событий. В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\

События изменения данных:
- `user:changed` - изменение данных пользователя
- `products:changed` - изменение массива карточек товаров
- `product:selected` - изменение открываемой в модальном окне карточки товара
- `product:previewClear` - очистка данных товара в модальном окне
- `cart:changed` - изменение массива товаров корзины
- `cartTotalPrice:changed` - изменение общей стоимости товаров корзины

События представления:
- `product:select` - выбор товара для отображения в модальном окне
- `product:submit` - добавление товара в корзину
- `product:delete` - удаление товара из корзины
- `product:validation` - событие, проверяющее возможность добавления товара в корзину
- `cartIcon:changed` - изменение количества товаров в корзине
- `cart:submit` - сохранение данных корзины в модальном окне
- `cart:validation` - событие, проверяющее наличие товаров в корзине
- `cartItem:remove` - удаление товара из корзины
- `order:input` - изменение данных в форме выбора типа оплаты и адреса
- `order:submit` - сохранение данных формы выбора типа оплаты и адреса в модальном окне
- `order:validation` - событие, сообщающее о необходимости валидации формы выбора способа оплаты и адреса пользователя
- `contacts:input` - изменение данных в форме с почтой и телефоном пользователя
- `contacts:submit` - сохранение почты и номера телефона пользователя в модальном окне
- `contacts:validation` - событие, сообщающее о необходимости валидации формы почты и телефона пользователя
- `success:submit` - закрытие модального окна успешной покупки